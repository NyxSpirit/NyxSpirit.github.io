<html>
<head>
    
    <meta charset='utf8'>
    
    <title>滚动新闻(FakeNyx)</title>
    
    <link rel='stylesheet' type='text/css' href='css/NewsPage.css'>
    
    <script type="text/javascript" src="http://learn.cic.tsinghua.edu.cn:80/res/common/js/library/jquery/jquery-1.7.2.min.js"></script>

<script type="text/javascript">

    
    $('document').ready(LoadNews());

    var json;
    var curNews = 0;
    var curSliderPos = 0;
    var comments;

    function setCurrent(value) {
    	var mainNews = $("img.mainPic");
        mainNews.fadeTo('normal', 0.4, function(){
            mainNews[0].src = json.newsInfo[value].picUrl;
            $('div.newsTitle')[0].innerHTML = '<a href = ' + json.newsInfo[value].detailUrl + '>' + json.newsInfo[value].title + '</a>';
            $('div.abbrPics').children()[curNews].setAttribute('border',"none");
            curNews = value;  
        });
        mainNews.fadeTo('normal',1,function(){
            $('div.abbrPics').children()[curNews].setAttribute('border',"5px#FFFFFF");
            
        });
    }

    function LoadNews(){
        var xmlhttp;

        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest(); 
        }
        else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                json = eval("(" + xmlhttp.responseText + ")");

                var mainNews = $("<img class = 'mainPic'/>");
                mainNews[0].src = json.newsInfo[0].picUrl;
                $('div.mainPic').append(mainNews);
                $('div.newsTitle')[0].innerHTML = '<a href = ' + json.newsInfo[0].detailUrl + '>' +json.newsInfo[0].title + '</a>';
                curNews = 0;

                var picSec = $('div.abbrPics');
				for (i in json.newsInfo) {
				    var newpic = $("<img/>");
				    newpic[0].src = json.newsInfo[i].picUrl;
				    newpic.css('left',5+(i>=7)*(1218));
				    newpic.css('top',(i>=7)*(-150));
				    newpic.css('position','relative');
				    newpic.addClass('abbrPic');
				    picSec.append(newpic);
				}
		picSec.css('left',0);
		picSec.css('position','relative');
		$('aside')[0].style.left = $('body')[0].clientWidth-300;
            }
        }
        var url = './NewsSrc.json';
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function SlideOn() {
        if (curNews < json.totalNumber - 1) setCurrent(curNews + 1);
        else setCurrent(0);
        setTimeout('SlideOn()', 5000);
    }
    
    function picSlideBack() {
        var slider = $('div.abbrPics');
        if (curSliderPos <= -175) {
            curSliderPos = curSliderPos + 175;
            slider.animate({left:  (String(curSliderPos) + 'px')}, 'slow');
        }
    };
    function picSlideNext() { 
        var slider = $('div.abbrPics');
        if (curSliderPos >= -175*(json.totalNumber-1)+1218){
            curSliderPos = curSliderPos - 175;
            slider.animate({left:  (String(curSliderPos) + 'px')}, 'slow');
        }
    };
    function picMainBack() {
        if (curNews > 0){
            curNews = curNews - 1;
            setCurrent(curNews);
        }
    };
    function picMainNext() { 
        
        if (curNews < json.totalNumber-1){
            curNews = curNews + 1;
            setCurrent(curNews);
        }
    };   
    
    function PutOnComments(x, y, cnt)
    {
    	var newCom = $('<div style="position:absolute;background-color:green;opacity:0.5"/>');
    	newCom[0].innerHTML = cnt;
    	newCom.css('left',x)
    	newCom.css('top',y);
    	newCom.css('zIndex',200);
    	newCom.css('height',200);
    	newCom.css('width',200);
    	$('img.mainPic').append(newCom);
    }
    
    function getComments() {
        var xmlhttp;

        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest(); 
        }
        else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            	comments = eval("(" + xmlhttp.responseText + ")");
            	
            	
            	for(i in comments.comments){
            	     PutOnComments(comments.comments[i].pos_x,comments.comments[i].pos_y,comments.comments[i].content);
            	}
            	
            }
        }
    	var url = './comments.json';
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }
    setTimeout('SlideOn()', 5000);
    
</script>
</head>

<body>
    <aside class ="commentSection">
        <div class ="showComment" onclick = "getComments()" style = "cursor:pointer">
            <p class ="center">显示评论</p>
        </div>
        <div class ="addComment">
            <h1>添加评论</h1>
            <input />
        </div>
        <div class ="otherFunc">
            <h1>分享</h1>
        </div>
    </aside>   
    <section class="picSection">
        <div class="prevNews" onclick ="picMainBack()" style = "cursor:pointer"> 
            <h1> < </h1>
        </div>
        <div class="mainPic">
            <div class="newsTitle">
                <a>No News Now.</a>
            </div>
        </div>       
        <div class="nextNews" onclick ="picMainNext()" style = "cursor:pointer">
            下一张
        </div>
           
        <div style ="clear:both;height:20px"></div>
        
        <div class="prevGroup" onclick ="picSlideBack()" style = "cursor:pointer">
            上一批
        </div>
        <div class="slider">
        <div class="abbrPics">
            
        </div>
        </div>        
        <div class="nextGroup" onclick ="picSlideNext()" style = "cursor:pointer">
            下一批
        </div>
        <div style ="clear:both;height:0px"></div>
    
    </section>


</body>
</html>

